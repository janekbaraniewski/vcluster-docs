---
title: Namespaces
sidebar_label: namespaces
sidebar_position: 6
sidebar_class_name: pro
description: Configure namespace synchronization between vCluster and host cluster.
---

import HiddenCodeBlock from '@site/src/components/HiddenCodeBlock';

import ProAdmonition from '../../../../../_partials/admonitions/pro-admonition.mdx'

import Flow, { Step } from "@site/src/components/Flow";

<ProAdmonition/>

<!-- vale off -->

By default, this is disabled.

By default, vCluster creates all namespaced resources that need to be synchronized to the host cluster in the same namespace where the vCluster is running. To avoid naming conflicts between resources with identical names across different virtual namespaces, vCluster rewrites their names before syncing them to the host cluster.

For example, vCluster transforms a pod named `test` in namespace `my-namespace` to `test-x-my-namespace-x-my-vcluster` in the host cluster. This transformation prevents conflicts with other pods named `test` in different namespaces within the vCluster.

Since vCluster rewrites resource names to avoid conflicts, any references to those resources must also be updated. vCluster handles this automatically for core Kubernetes resources. For example, when a Pod mounts a Secret, vCluster ensures the reference maps to the correct Secret name on the host clusterâ€”without exposing this complexity inside the vCluster.

However, syncing [custom resources](./custom-resources.mdx) can be more difficult. These resources often contain references in non-standard formats or deeply nested fields. This can make automatic rewriting unreliable or impossible. Manually managing these references can quickly become tedious and error-prone.

To handle these cases, vCluster supports namespace sync with custom mapping rules. These rules give you more control over how resources and their references are mapped between the virtual and host clusters. This is especially useful for complex workloads involving custom or non-standard Kubernetes resources.

## Enable namespace syncing

Configure namespace syncing by setting `sync.toHost.namespaces.enabled: true` in your `vcluster.yaml` file.

```yaml
sync:
  toHost:
    namespaces:
      enabled: true
```

When enabled, vCluster creates namespaces on the host cluster that correspond to namespaces created within the vCluster, following the defined mapping rules.

## Configure mappings

Namespace syncing supports several mapping rule types with the `mappings.byName` field:

- **Exact mappings**: Map a specific virtual namespace name to a specific host namespace name.
- **Pattern mappings**: Use a single wildcard `*` character to map a range of virtual namespaces to a corresponding range of host namespaces. The wildcard content mirrors between virtual and host.
- **`${name}` variable**: This variable substitutes automatically with the vCluster instance's name. Use this to create predictable host namespaces that clearly associate with a particular vCluster instance.

Combine the `${name}` variable with pattern mappings for flexible namespace organization.

:::important
Define only exact-to-exact or pattern-to-pattern mappings. Mixing these types (exact virtual namespace to patterned host namespace, or patterned virtual namespace to exact host namespace) is not supported.
:::

Configure different mapping types in your `vcluster.yaml`:

```yaml title="vcluster-mappings-example.yaml"
sync:
  toHost:
    namespaces:
      enabled: true
      mappings:
        byName:
          # Exact mapping:
          # Virtual NS "frontend-prod" -> Host NS "customer-project-alpha-prod"
          "frontend-prod": "customer-project-alpha-prod"

          # Pattern mapping:
          # Virtual NS "team-a-*" -> Host NS "h-team-a-*"
          # e.g., vNS "team-a-dev" -> hNS "h-team-a-dev"
          # e.g., vNS "team-a-staging" -> hNS "h-team-a-staging"
          "team-a-*": "h-team-a-*"

          # Pattern mapping using ${name} variable:
          # Assumes vCluster name is "my-vc"
          # Virtual NS "datasets-*" -> Host NS "my-vc-data-*"
          # e.g., vNS "datasets-raw" -> hNS "my-vc-data-raw"
          # e.g., vNS "datasets-processed" -> hNS "my-vc-data-processed"
          "datasets-*": "${name}-data-*"
```

### Test namespace mappings

The following example demonstrates how user and team identity mappings to cluster roles work in a virtual cluster.

<Flow>
<Step>
Deploy a vCluster named `mapping-demo` using the `vcluster-mappings-example.yaml` file above.

```bash
vcluster create mapping-demo -f vcluster-mappings-example.yaml
```
</Step>

<Step>
Inside the vCluster, create a namespace that matches the `team-a-*` pattern.

```bash
kubectl create namespace team-a-ns1
```
</Step>

<Step>
Create another namespace that matches the exact frontend-prod rule.

```bash
kubectl create namespace frontend-prod
```
</Step>

<Step>
Create a namespace that does not match any mapping rule.

```bash
kubectl create namespace some-other-namespace
```
</Step>

<Step>
Verify the namespaces on the host cluster.

```bash
kubectl --context kind-vcluster get namespace
```

```bash
NAME                              STATUS   AGE
customer-project-alpha-prod       Active   12s
default                           Active   45h
h-team-a-ns1                      Active   20s
kube-node-lease                   Active   45h
kube-public                       Active   45h
kube-system                       Active   45h
local-path-storage                Active   45h
vcluster-mapping-demo             Active   2m11s
```

Only namespaces matched by mappings sync directly to the host cluster.
</Step>

<Step>
Run a pod inside the mapped namespace.

```bash
kubectl -n team-a-ns1 run nginx-from-team-a --image nginx
```
</Step>

<Step>
Run a pod inside the non-mapped namespace.

```bash
kubectl -n some-other-namespace run nginx-from-other-namespace --image nginx
```
</Step>

<Step>
Verify both pods run inside vCluster.

```bash
kubectl get pods -A
```

```bash
NAMESPACE              NAME                         READY   STATUS    RESTARTS   AGE
kube-system            coredns-94f599b5-wdgzg       1/1     Running   0          1m
some-other-namespace   nginx-from-other-namespace   1/1     Running   0          11s
team-a-ns1             nginx-from-team-a            1/1     Running   0          18s
```
</Step>

<Step>
Verify pods running on the host cluster.

```bash
kubectl --context kind-vcluster get pods -A
```

```bash
NAMESPACE                         NAME                                                              READY   STATUS    RESTARTS      AGE
h-team-a-ns1                      nginx-from-team-a                                                 1/1     Running   0             58s
kube-system                       coredns-787d4945fb-5ljfb                                          1/1     Running   1 (20h ago)   45h
kube-system                       coredns-787d4945fb-zh9q7                                          1/1     Running   1 (20h ago)   45h
kube-system                       etcd-vcluster-pro-control-plane                                   1/1     Running   1 (20h ago)   45h
kube-system                       kindnet-8mmjr                                                     1/1     Running   1 (20h ago)   45h
kube-system                       kube-apiserver-vcluster-pro-control-plane                         1/1     Running   1 (20h ago)   45h
kube-system                       kube-controller-manager-vcluster-pro-control-plane                1/1     Running   1 (20h ago)   45h
kube-system                       kube-proxy-jnwfv                                                  1/1     Running   1 (20h ago)   45h
kube-system                       kube-scheduler-vcluster-pro-control-plane                         1/1     Running   1 (20h ago)   45h
local-path-storage                local-path-provisioner-75f5b54ffd-j6pjj                           1/1     Running   1 (20h ago)   45h
vcluster-mapping-demo             coredns-94f599b5-wdgzg-x-kube-system-x-default-namespace-sync     1/1     Running   0             1m
vcluster-mapping-demo             mapping-demo-0                                                    1/1     Running   0             86s
vcluster-default-namespace-sync   nginx-from-other-namespace-x-some-other-namespace-x--4b96e8f948   1/1     Running   0             51s
```

The pod from the mapped namespace syncs directly without renaming, while the pod from the non-mapped namespace uses default translation logic.
</Step>
</Flow>

### Test importing namespaces

Any namespace on host that matches any of the defined mappings, either exact or patterns, will get automatically imported into vCluster.
If namespace is imported through mappings, any workload started in this namespace on host will also get imported into vCluster.

<Flow>
<Step>

Create a namespace matching one of the mappings on host
This will match `"team-a-*": "h-team-a-*"` mapping

```bash
kubectl --context kind-vcluster create namespace  h-team-a-namespace-synced-from-host
```
</Step>
<Step>
Start a pod inside this namespace on host cluster

```bash
kubectl --context kind-vcluster -n h-team-a-namespace-synced-from-host run nginx-from-host --image nginx
```
</Step>
<Step>
Inside vCluster get namespaces

```bash
kubectl get namespace
```

Namespace was imported from host following defined mapping

```bash
NAME                                STATUS   AGE
default                             Active   58s
kube-node-lease                     Active   58s
kube-public                         Active   58s
kube-system                         Active   58s
team-a-namespace-synced-from-host   Active   14s
```
</Step>
<Step>
Check the pod running in this namespace

```bash
kubectl -n team-a-namespace-synced-from-host get pods
```

Pod was imported into vCluster

```bash
NAME              READY   STATUS    RESTARTS   AGE
nginx-from-host   1/1     Running   0          36s
```
</Step>
</Flow>
## Enforce mapping-only mode

By default (`mappingsOnly: false`), when you create a resource in a virtual namespace that does not match any defined mappings, vCluster syncs those resources to its own namespace on the host cluster using the standard name-rewriting strategy.

Change this behavior to strictly enforce that operations within the vCluster only occur for namespaces defined by your mappings. When a virtual namespace lacks a mapping, vCluster blocks attempts to create or sync resources in such namespaces.

Enable this stricter mode with `mappingsOnly: true`:

```yaml
# vcluster-mappings-only-example.yaml
sync:
  toHost:
    namespaces:
      enabled: true
      mappingsOnly: true # Enable strict mapping
      mappings:
        byName:
          # Only virtual namespaces starting with "synced-" will be mapped
          "synced-*": "host-${name}-synced-*"
          # And the virtual namespace "important-configs" maps to "host-configs-critical"
          "important-configs": "host-configs-critical"
```

### Test mapping-only restrictions

The following example shows how `mappingsOnly: true` restricts operations within vCluster to only mapped namespaces.

<Flow>
<Step>
Deploy a vCluster named `strict-vc` with the `vcluster-mappings-only-example.yaml` configuration.

```bash
vcluster create strict-vc -f vcluster-mappings-only-example.yaml
```
</Step>

<Step>
Inside the vCluster, create a namespace that matches a mapping rule.

```bash
kubectl create namespace synced-data-alpha
```

This matches `synced-*`. vCluster creates the `host-strict-vc-synced-data-alpha` namespace on the host, and resources created in the virtual `synced-data-alpha` namespace appear there.
</Step>

<Step>
Create a namespace that does not match any rule.

```bash
kubectl create namespace experimental-app
```

```bash
Error from server (Forbidden): Virtual namespace 'experimental-app' is not allowed by vcluster mappings. Allowed namespaces are important-configs, synced-* (post namespaces)
```

vCluster blocks this namespace. Any operation on namespaces not defined in mappings gets blocked when `mappingsOnly` mode is enabled.
</Step>
</Flow>

## Deleting vCluster

When deleting vCluster, all namespaces created on host as a result of syncing from vCluster as well as all resources running inside of them
will get removed from host. All resources that were started on host and imported into vCluster as result of namespace syncing will remain on
host untouched.

We can test this behaviour by deploying vCluster with following configuration:

```yaml
# vcluster-test-cleanup.yaml
sync:
  toHost:
    namespaces:
      enabled: true
      mappings:
        byName:
          sync-*: host-*
```

<Flow>

<Step>
First, create a namespace on your host cluster that matches host-side mappings in our configuration and start a pod inside of it.

```bash
kubectl --context kind-vcluster create namespace host-namespace-from-host
kubectl --context kind-vcluster -n host-namespace-from-host run nginx-from-host --image nginx
```

</Step>

<Step>
Verify that the pod started in host cluster

```bash
kubectl --context kind-vcluster -n host-namespace-from-host get pods
```

```bash
NAME              READY   STATUS    RESTARTS   AGE
nginx-from-host   1/1     Running   0          50s
```

</Step>

<Step>
Create vCluster using values from above:

```bash
vcluster create test-cleanup -f values-test-cleanup.yml
```

</Step>

<Step>
Create namespace inside vCluster and start a pod in it:

```bash
kubectl create namespace sync-namespace-from-vcluster
kubectl -n sync-namespace-from-vcluster run nginx-from-vcluster --image nginx
```
</Step>

<Step>
Verify both namespaces are available in both host cluster and vCluster:

```bash
kubectl get ns
```

```bash
NAME                           STATUS   AGE
default                        Active   3m35s
kube-node-lease                Active   3m35s
kube-public                    Active   3m35s
kube-system                    Active   3m35s
sync-namespace-from-host       Active   2m21s
sync-namespace-from-vcluster   Active   5s
```

```bash
kubectl --context kind-vcluster get ns
```

```bash
NAME                           STATUS   AGE
default                        Active   6d23h
host-namespace-from-host       Active   3m3s
host-namespace-from-vcluster   Active   47s
kube-node-lease                Active   6d23h
kube-public                    Active   6d23h
kube-system                    Active   6d23h
local-path-storage             Active   6d23h
vcluster-test-cleanup          Active   4m43s
```

```bash
kubectl get po -A | grep nginx
```

```bash
sync-namespace-from-host       nginx-from-host          1/1     Running   0          3m58s
sync-namespace-from-vcluster   nginx-from-vcluster      1/1     Running   0          114s
```

```bash
kubectl --context kind-vcluster-pro get po -A | grep nginx
```

```bash
host-namespace-from-host       nginx-from-host                                       1/1     Running             0          4m7s
host-namespace-from-vcluster   nginx-from-vcluster                                   1/1     Running             0          2m3s
```

</Step>


<Step>
Delete vCluster

```bash
vcluster delete test-cleanup
```

```bash
12:29:31 info Stopping background proxy...
12:29:31 info Delete vcluster test-cleanup...
12:29:31 done Successfully deleted virtual cluster test-cleanup in namespace vcluster-test-cleanup
12:29:31 info Starting cleanup of vCluster 'test-cleanup' namespaces.
12:29:31 info Namespace 'host-namespace-from-host' was imported, cleaning up its resources and metadata...
12:29:36 info Deleting virtual cluster namespace 'host-namespace-from-vcluster'
12:29:36 info Successfully deleted virtual cluster namespace 'host-namespace-from-vcluster'
12:29:36 info Cleanup of vCluster 'test-cleanup' namespaces finished.
12:29:36 done Successfully deleted virtual cluster namespace vcluster-test-cleanup
12:29:36 info Waiting for virtual cluster to be deleted...
12:29:47 done Virtual Cluster is deleted
```

</Step>

<Step>
Verify namespaces and resources left on host

```bash
kubectl --context kind-vcluster-pro get ns
```

```bash
NAME                       STATUS   AGE
default                    Active   6d23h
host-namespace-from-host   Active   6m55s
kube-node-lease            Active   6d23h
kube-public                Active   6d23h
kube-system                Active   6d23h
local-path-storage         Active   6d23h
```

```bash
kubectl --context kind-vcluster-pro get pods -n host-namespace-from-host
```

```bash
NAME              READY   STATUS    RESTARTS   AGE
nginx-from-host   1/1     Running   0          6m48s
```

Resources synced from vCluster are gone while all resources created on host cluster remained untouched.


</Step>


</Flow>